{% extends 'base.html' %}
{% block title %} Check Contracts {% endblock title %}
{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.css') }}">
{% endblock style %}
{% block class_all_contracts %}active{% endblock class_all_contracts %}
{% block class_check_contract_li %}remove-pointer{% endblock class_check_contract_li %}
{% block loading %}
    <div class="loader">
        <div class="inner one"></div>
        <div class="inner two"></div>
        <div class="inner three"></div>
    </div>
{% endblock loading %}
{% block content_part %}
    {% set counter = namespace(value=(page - 1) * posts_per_page) %}
    <table class="table">
        <caption>
            <div class="table__header">
                <div class="table__header__search">
                    <form action="{{ url_for('all_contracts.get_all_contracts') }}" method="get">
                        {{ form.search(class="table__header__search__label", placeholder="Search") }}
                        <button class="table__header__search__button" type="submit" name="action" value="search">Search</button>
                        <button class="table__header__search__button" type="submit" name="action" value="all">All Contracts</button>
                        <label id="label-filter" for="filter-selection"></label>
                        <select name="filters" id="filter-selection" class="filter-button">
                            <option value="" selected disabled hidden>Filters</option>
                            <option value="company" {% if filters == "company" and action == "search" %}selected{% endif %}>Company</option>
                            <option value="date" {% if filters == "date" and action == "search" %}selected{% endif %}>Date</option>
                            <option value="amount" {% if filters == "amount" and action == "search" %}selected{% endif %}>Amount</option>
                        </select>
                        <label id="label-filter" for="order-selection"></label>
                        <select name="orders" id="order-selection" class="order-button">
                            <option value="" selected disabled hidden>Order by</option>
                            <option value="ascending"  {% if order == "ascending" and action == "search" %}selected{% endif %}>Ascending</option>
                            <option value="descending" {% if order == "descending" and action == "search" %}selected{% endif %}>Descending</option>
                        </select>
                    </form>
                </div>
                All Contracts -{% if companies != [] %} {{ amount_of_companies }} {% else %} 0 {% endif %}
            </div>
        </caption>
        <thead>
            <tr>
                <th><strong>No</strong></th>
                <th>COMPANY</th>
                <th>Voen</th>
                <th>Contract number</th>
                <th>date</th>
                <th>amount</th>
            </tr>
        </thead>
        <tbody>
            {% for company in companies %}
                {% if company.__class__.__name__ == 'Companies' %}
                    {% for contract in company.contracts %}
                        {% set counter.value = counter.value + 1 %}
                        <tr>
                            <td>{{ counter.value }}</td>
                            <td>{{ company.company_name }}</td>
                            <td>{{ company.voen }}</td>
                            <td>{{ contract.contract_number }}</td>
                            <td>{{ contract.date }}</td>
                            <td>{{ "%.2f"| format(contract.amount)  }}</td>
                            <td class="check_option">
                                <a class="check" href={{ url_for('all_contracts.get_contract', contract_id=contract.id) }}>Check</a>
                            </td>
                             <td>
                                <svg onclick="openPopUpMenu('{{ url_for('all_contracts.delete_contract', contract_id=contract.id) }}')" xmlns="http://www.w3.org/2000/svg" class="delete" viewBox="0 0 512 512">
                                    <path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path>
                                    <path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352"/><path d="M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                            </td>
                            <td></td>
                        </tr>
                    {% endfor %}
                {% elif company.__class__.__name__ == 'Contract' %}
                    {% set counter.value = counter.value + 1 %}
                    <tr>
                            <td>{{ counter.value }}</td>
                            <td>{{ company.company.company_name }}</td>
                            <td>{{ company.company.voen }}</td>
                            <td>{{ company.contract_number }}</td>
                            <td>{{ company.date }}</td>
                            <td>{{ "%.2f"| format(company.amount)  }}</td>
                            <td>
                                <a class="check" href={{ url_for('all_contracts.get_contract', contract_id=company.id) }}>Check</a>
                            </td>
                            <td>
                                <svg onclick="openPopUpMenu('{{ url_for('all_contracts.delete_contract', contract_id=company.id) }}')"  xmlns="http://www.w3.org/2000/svg" class="delete"
                                     viewBox="0 0 512 512">
                                    <path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path>
                                    <path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352"/><path d="M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                            </td>
                        </tr>
                {% endif %}
            {% endfor %}
            <tr class="pagination_buttons">
                <td id="prev">
                    <form action="{{ url_for("all_contracts.get_all_contracts") }}" method="get">
                        {% if action == 'search' %}
                            <input type="hidden" name="search" value="{{ search_query }}">
                            <input type="hidden" name="action" value="{{ action }}">

                            {% if filters != "" %}
                                <input type="hidden" name="filters" value="{{ filters }}">
                            {% endif %}
                            {% if order != "" %}
                                <input type="hidden" name="orders" value="{{ order }}">
                            {% endif %}
                        {% elif  action == 'all' %}
                            <input type="hidden" name="search" value="{{ search_query }}">
                            <input type="hidden" name="action" value="{{ action }}">
                        {% endif %}

                        {% if page > 1  %}
                            <button class="prev" type="submit" name="page" value="{{ page - 1 }}">Prev</button>
                        {% else %}
                            <button class="prev" disabled>Prev</button>
                        {% endif %}
                    </form>
                </td>
                <td id="page_number">
                    Page: {{ page }}
                </td>
                <td id="next">
                    <form action="{{ url_for("all_contracts.get_all_contracts") }}" method="get">
                        {% if action == 'search'%}
                            <input type="hidden" name="search" value="{{ search_query }}">
                            <input type="hidden" name="action" value="{{ action }}">
                            {% if filters != "" %}
                                <input type="hidden" name="filters" value="{{ filters }}">
                            {% endif %}

                            {% if order != "" %}
                                <input type="hidden" name="orders" value="{{ order }}">
                            {% endif %}
                        {% elif  action == 'all' %}
                            <input type="hidden" name="search" value="{{ search_query }}">
                            <input type="hidden" name="action" value="{{ action }}">
                        {% elif action == 'company_search' %}
                        {% endif %}
                        {%  if page < total_pages %}
                            <button type="submit" class="next" name="page" value="{{ page + 1 }}">Next</button>
                        {% else %}
                            <button class="next" disabled>Next</button>
                        {% endif %}
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
    {% block pop_up_message %}
            {% with messages = get_flashed_messages(with_categories=True) %}
                    {% if messages %}
                        <div class="error">
                        {% for category, message in messages %}
                            {% if category == 'success' %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.25 16.518l-4.5-4.319 1.396-1.435 3.078 2.937 6.105-6.218 1.421 1.409-7.5 7.626z">
                                    </path>
                                </svg>
                                <div class="error__description">
                                    <strong>Success</strong>
                                    <p class="error__text">{{ message }}</p>
                                </div>
                            {% elif category == "warning" %}
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                    <defs>
                                    </defs>
                                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                        <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 24.813 0 45 20.187 45 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,170,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                        <path d="M 45 57.469 L 45 57.469 c -1.821 0 -3.319 -1.434 -3.399 -3.252 L 38.465 23.95 c -0.285 -3.802 2.722 -7.044 6.535 -7.044 h 0 c 3.813 0 6.82 3.242 6.535 7.044 l -3.137 30.267 C 48.319 56.036 46.821 57.469 45 57.469 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                        <circle cx="45" cy="67.67" r="5.42" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform="  matrix(1 0 0 1 0 0) "/>
                                    </g>
                                </svg>
                                <div class="error__description">
                                    <strong>Warning</strong>
                                    <p class="success-adding__text">{{ message }}</p>
                                </div>
                            {% elif category == "error" %}
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                <defs>
                                </defs>
                                <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                    <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 24.813 0 45 20.187 45 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(229,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                    <path d="M 45 57.469 L 45 57.469 c -1.821 0 -3.319 -1.434 -3.399 -3.252 L 38.465 23.95 c -0.285 -3.802 2.722 -7.044 6.535 -7.044 h 0 c 3.813 0 6.82 3.242 6.535 7.044 l -3.137 30.267 C 48.319 56.036 46.821 57.469 45 57.469 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                    <circle cx="45" cy="67.67" r="5.42" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform="  matrix(1 0 0 1 0 0) "/>
                                </g>
                                </svg>
                                 <div class="error__description">
                                    <strong>Error</strong>
                                    <p class="error__text">{{ message }}</p>
                                </div>
                            {% endif %}
                        {% endfor %}
                        </div>
                    {% endif %}
            {% endwith %}
        {% endblock pop_up_message %}
{% endblock content_part %}
{% block javascript %}
    <script src="{{ url_for('static', filename='js/all_contracts_search_bar.js') }}"></script>
    <script src={{ url_for('static', filename='js/add_contract.js') }}></script>
    <script src="{{ url_for('static', filename='js/loading_screen.js') }}"></script>
    <script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
    <script src="{{ url_for('static', filename='js/clear_url.js') }}"></script>
     <script type="text/javascript">
        const csrf_token = "{{ csrf_token() }}"
    </script>
    <script src="{{ url_for('static', filename='js/delete.js') }}"></script>
{% endblock javascript %}