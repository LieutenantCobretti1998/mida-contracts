{% extends "base.html" %}
{% block title %} Check Companies {% endblock title %}
{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/check_companies.css') }}" />
    <link href="https://unpkg.com/gridjs@6.2.0/dist/theme/mermaid.min.css" rel="stylesheet" />
{% endblock style %}

{% block class_all_companies %}active{% endblock class_all_companies %}
{% block class_all_company_li %}remove-pointer{% endblock class_all_company_li %}

{% block content_part %}
    <div id="results"></div>
    {% block pop_up_message %}
            {% with messages = get_flashed_messages(with_categories=True) %}
                    {% if messages %}
                        <div class="error">
                        {% for category, message in messages %}
                            {% if category == 'success' %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1.25 16.518l-4.5-4.319 1.396-1.435 3.078 2.937 6.105-6.218 1.421 1.409-7.5 7.626z">
                                    </path>
                                </svg>
                                <div class="error__description">
                                    <strong>Success</strong>
                                    <p class="error__text">{{ message }}</p>
                                </div>
                            {% elif category == "warning" %}
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                    <defs>
                                    </defs>
                                    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                        <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 24.813 0 45 20.187 45 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,170,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                        <path d="M 45 57.469 L 45 57.469 c -1.821 0 -3.319 -1.434 -3.399 -3.252 L 38.465 23.95 c -0.285 -3.802 2.722 -7.044 6.535 -7.044 h 0 c 3.813 0 6.82 3.242 6.535 7.044 l -3.137 30.267 C 48.319 56.036 46.821 57.469 45 57.469 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                        <circle cx="45" cy="67.67" r="5.42" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform="  matrix(1 0 0 1 0 0) "/>
                                    </g>
                                </svg>
                                <div class="error__description">
                                    <strong>Warning</strong>
                                    <p class="success-adding__text">{{ message }}</p>
                                </div>
                            {% elif category == "error" %}
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                <defs>
                                </defs>
                                <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                    <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 24.813 0 45 20.187 45 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(229,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                    <path d="M 45 57.469 L 45 57.469 c -1.821 0 -3.319 -1.434 -3.399 -3.252 L 38.465 23.95 c -0.285 -3.802 2.722 -7.044 6.535 -7.044 h 0 c 3.813 0 6.82 3.242 6.535 7.044 l -3.137 30.267 C 48.319 56.036 46.821 57.469 45 57.469 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                    <circle cx="45" cy="67.67" r="5.42" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" transform="  matrix(1 0 0 1 0 0) "/>
                                </g>
                                </svg>
                                 <div class="error__description">
                                    <strong>Error</strong>
                                    <p class="error__text">{{ message }}</p>
                                </div>
                            {% endif %}
                        {% endfor %}
                        </div>
                    {% endif %}
            {% endwith %}
        {% endblock pop_up_message %}
{% endblock content_part %}
{% block javascript %}
    <script src="https://unpkg.com/gridjs@6.2.0/dist/gridjs.umd.js"></script>
   <script type="module">
        const grid = new gridjs.Grid({
            columns: [
                {
                    name: "Company Id",
                    hidden: true
                },

                {
                    name: "Company Name"
                },
                {
                    name: "Voen"
                },
                {
                    name: "Email"
                },
                {
                    name: "Tel Number"
                },
                {
                    name: "Address"
                },
                {
                    name: "Website",
                    formatter: (cell, _) => {
                        return gridjs.html(
                            cell ? `<a href="${cell}">Link</a>` : ''
                        )
                    }
                },
                {
                    name: "Bank"
                },
                {
                    name: "M-H"
                },
                {
                    name: "H-H"
                },
                {
                    name: "Swift"
                },
                {
                    sort: false,
                    name: "Actions",
                    formatter: (cell, row) => {
                        const company_id = row.cells[0].data;

                         return gridjs.html(
                               `<span style="display: flex; justify-content: space-between">` +
                                    `<button type="button" class="edit-btn" data-company-id=${company_id}>Edit</button>` +

                               `</span>`
                           );
                    }
                }
            ],
            pagination: {
                limit: 10,
                page: 10,
                server : {
                    url: (prev, page, limit) => {
                        const hasQuery = prev.includes("?");
                        const prefix = hasQuery ? "&": "?";
                        return `${prev}${prefix}limit=${limit}&page=${page + 1}`;
                    }
                }
            },
            sort: {
                multiColumn: false,
                server: {
                    url: (prev, columns) => {
                        if (!columns.length) return prev;

                        const col = columns[0];
                        const dir = col.direction === 1 ? "asc": "desc";
                        let colName = ["Company Id", "Company Name", "Voen", "Email", "Tel Number", "Address", "Website", "Bank", "M-H", "H-H", "Swift"][col.index];
                        return `${prev}?order_by=${colName}&dir=${dir}`;
                    }
                }
            },
            search: {
                server: {
                    url: (prev, keyword) => `${prev}/${encodeURIComponent(keyword)}`
                }
            },
            server: {
                url: "/api/all_companies",
                then: data => data.data.map(company => [
                    company.id,
                    company.company_name,
                    company.voen,
                    company.email,
                    company.telephone_number,
                    company.address,
                    company.website,
                    company.bank_name,
                    company.m_h,
                    company.h_h,
                    company.swift,
                ]),
                total: data => data.total_count
            },
        })
         grid.render(document.getElementById("results"));
    </script>
{% endblock javascript %}